---
#Apply PSU version specific one-off patches
- name: PSU Version Specific Oneoff conflict check
  shell: "{{ oracle_home }}/OPatch/opatch prereq CheckConflictAgainstOHWithDetail -phBaseDir {{ patch_directory }}/{{ item.patchid }}"
  sudo: yes
  sudo_user: "{{ oracle_user }}"
  with_items: oneoff_patches[ psu[oracle_version][psu_name].patchversion ]|default([])
  when: oneoff_patches[ psu[oracle_version][psu_name].patchversion ] is defined
  register: oneoff_conflicts_psu

- debug: var=oneoff_conflicts_psu.results

- name: Apply PSU Version Specific one-off patches
  shell: "opatch apply -silent -local -force -ocmrf {{ oracle_stage_install }}/ocm.rsp {{ patch_directory }}/{{ item.patchid }}"
  sudo: yes
  sudo_user: "{{ oracle_user }}"
  environment: "{{ env }}"
  with_items: oneoff_patches[ psu[oracle_version][psu_name].patchversion ]|default([])
  when: oneoff_patches[ psu[oracle_version][psu_name].patchversion ] is defined
  register: oneoff_apply_psu

- debug: var=oneoff_apply_psu.results
